<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 700" width="1000" height="700">
  <defs>
    <style>
      .title { font: bold 20px sans-serif; fill: #1a1a2e; }
      .box-label { font: bold 11px sans-serif; fill: #fff; }
      .box-detail { font: 9px sans-serif; fill: #fff; opacity: 0.8; }
      .section-label { font: bold 12px sans-serif; fill: #333; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-data { stroke: #3498db; stroke-width: 2; fill: none; marker-end: url(#arrowhead-blue); }
      .arrow-depends { stroke: #e94560; stroke-width: 2; stroke-dasharray: 5,3; fill: none; marker-end: url(#arrowhead-red); }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#666"/>
    </marker>
    <marker id="arrowhead-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#3498db"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#e94560"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1000" height="700" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="500" y="35" text-anchor="middle" class="title">Service Dependency Map</text>
  
  <!-- Legend -->
  <rect x="700" y="50" width="280" height="70" rx="5" fill="#fff" stroke="#ddd" stroke-width="1"/>
  <text x="840" y="70" text-anchor="middle" font-size="11" font-weight="bold" fill="#333">Legend</text>
  <line x1="720" y1="85" x2="760" y2="85" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="770" y="89" font-size="10" fill="#333">Request Flow</text>
  <line x1="720" y1="100" x2="760" y2="100" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead-blue)"/>
  <text x="770" y="104" font-size="10" fill="#333">Data Flow</text>
  <line x1="720" y1="115" x2="760" y2="115" stroke="#e94560" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead-red)"/>
  <text x="770" y="119" font-size="10" fill="#333">Depends On</text>
  
  <!-- USER -->
  <ellipse cx="100" cy="200" rx="50" ry="25" fill="#74b9ff" stroke="#0984e3" stroke-width="2"/>
  <text x="100" y="205" text-anchor="middle" class="box-label" fill="#0984e3">USER</text>
  
  <!-- NGINX Proxy Manager -->
  <rect x="200" y="175" width="120" height="50" rx="5" fill="#16213e"/>
  <text x="260" y="198" text-anchor="middle" class="box-label">NGINX PM</text>
  <text x="260" y="212" text-anchor="middle" class="box-detail">SSL Termination</text>
  
  <!-- Arrow: User to NGINX -->
  <line x1="150" y1="200" x2="195" y2="200" class="arrow"/>
  
  <!-- Public Services -->
  <rect x="380" y="80" width="100" height="45" rx="5" fill="#27ae60"/>
  <text x="430" y="100" text-anchor="middle" class="box-label">Plex</text>
  <text x="430" y="115" text-anchor="middle" class="box-detail">:32400</text>
  
  <rect x="380" y="140" width="100" height="45" rx="5" fill="#27ae60"/>
  <text x="430" y="160" text-anchor="middle" class="box-label">Immich</text>
  <text x="430" y="175" text-anchor="middle" class="box-detail">:8082</text>
  
  <rect x="380" y="200" width="100" height="45" rx="5" fill="#27ae60"/>
  <text x="430" y="220" text-anchor="middle" class="box-label">Overseerr</text>
  <text x="430" y="235" text-anchor="middle" class="box-detail">:5055</text>
  
  <rect x="380" y="260" width="100" height="45" rx="5" fill="#27ae60"/>
  <text x="430" y="280" text-anchor="middle" class="box-label">Vaultwarden</text>
  <text x="430" y="295" text-anchor="middle" class="box-detail">:8200</text>
  
  <rect x="380" y="320" width="100" height="45" rx="5" fill="#27ae60"/>
  <text x="430" y="340" text-anchor="middle" class="box-label">FileBrowser</text>
  <text x="430" y="355" text-anchor="middle" class="box-detail">:8084</text>
  
  <!-- Arrows: NGINX to Public Services -->
  <path d="M 320 185 Q 350 100 375 102" class="arrow" fill="none"/>
  <path d="M 320 190 Q 350 160 375 162" class="arrow" fill="none"/>
  <line x1="320" y1="200" x2="375" y2="222" class="arrow"/>
  <path d="M 320 210 Q 350 260 375 280" class="arrow" fill="none"/>
  <path d="M 320 215 Q 350 320 375 340" class="arrow" fill="none"/>
  
  <!-- Immich Dependencies -->
  <rect x="530" y="120" width="80" height="35" rx="3" fill="#9b59b6"/>
  <text x="570" y="142" text-anchor="middle" class="box-label">Redis</text>
  
  <rect x="530" y="165" width="80" height="35" rx="3" fill="#9b59b6"/>
  <text x="570" y="187" text-anchor="middle" class="box-label">PostgreSQL</text>
  
  <line x1="480" y1="155" x2="525" y2="140" class="arrow-depends"/>
  <line x1="480" y1="168" x2="525" y2="180" class="arrow-depends"/>
  
  <!-- Media Request Flow -->
  <rect x="530" y="200" width="80" height="45" rx="5" fill="#e94560"/>
  <text x="570" y="220" text-anchor="middle" class="box-label">Radarr</text>
  <text x="570" y="235" text-anchor="middle" class="box-detail">:7878</text>
  
  <rect x="530" y="260" width="80" height="45" rx="5" fill="#e94560"/>
  <text x="570" y="280" text-anchor="middle" class="box-label">Sonarr</text>
  <text x="570" y="295" text-anchor="middle" class="box-detail">:8989</text>
  
  <!-- Arrow: Overseerr to Radarr/Sonarr -->
  <line x1="480" y1="215" x2="525" y2="220" class="arrow"/>
  <line x1="480" y1="230" x2="525" y2="275" class="arrow"/>
  
  <!-- Prowlarr -->
  <rect x="650" y="230" width="80" height="45" rx="5" fill="#e94560"/>
  <text x="690" y="250" text-anchor="middle" class="box-label">Prowlarr</text>
  <text x="690" y="265" text-anchor="middle" class="box-detail">:9696</text>
  
  <!-- Arrows: Radarr/Sonarr to Prowlarr -->
  <line x1="610" y1="222" x2="645" y2="245" class="arrow"/>
  <line x1="610" y1="278" x2="645" y2="260" class="arrow"/>
  
  <!-- VPN Gateway + qBittorrent -->
  <rect x="770" y="200" width="100" height="45" rx="5" fill="#8e44ad"/>
  <text x="820" y="220" text-anchor="middle" class="box-label">ProtonVPN</text>
  <text x="820" y="235" text-anchor="middle" class="box-detail">Gluetun</text>
  
  <rect x="770" y="260" width="100" height="45" rx="5" fill="#8e44ad"/>
  <text x="820" y="280" text-anchor="middle" class="box-label">qBittorrent</text>
  <text x="820" y="295" text-anchor="middle" class="box-detail">:8083</text>
  
  <!-- Arrows: Prowlarr to qBittorrent, qBittorrent depends on VPN -->
  <line x1="730" y1="252" x2="765" y2="275" class="arrow"/>
  <line x1="820" y1="260" x2="820" y2="250" class="arrow-depends"/>
  
  <!-- Internet (for VPN) -->
  <ellipse cx="920" cy="220" rx="50" ry="25" fill="#74b9ff" stroke="#0984e3" stroke-width="2"/>
  <text x="920" y="225" text-anchor="middle" class="box-label" fill="#0984e3">Internet</text>
  
  <line x1="870" y1="220" x2="875" y2="220" class="arrow"/>
  
  <!-- Storage -->
  <rect x="650" y="340" width="220" height="50" rx="5" fill="#3498db"/>
  <text x="760" y="362" text-anchor="middle" class="box-label">ZFS Storage Pool</text>
  <text x="760" y="378" text-anchor="middle" class="box-detail">/mnt/main-storage (RAID-Z1)</text>
  
  <!-- Data flow to storage -->
  <line x1="820" y1="305" x2="780" y2="335" class="arrow-data"/>
  <line x1="430" y1="140" x2="650" y2="355" class="arrow-data"/>
  <line x1="430" y1="365" x2="650" y2="365" class="arrow-data"/>
  
  <!-- Plex reads from storage -->
  <path d="M 430 125 Q 500 400 650 370" class="arrow-data" fill="none"/>
  
  <!-- Monitoring Section -->
  <rect x="50" y="420" width="900" height="130" rx="5" fill="#f5f5f5" stroke="#ddd" stroke-width="1"/>
  <text x="70" y="445" class="section-label">Monitoring &amp; Logging</text>
  
  <rect x="70" y="460" width="100" height="45" rx="5" fill="#16213e"/>
  <text x="120" y="480" text-anchor="middle" class="box-label">Uptime Kuma</text>
  <text x="120" y="495" text-anchor="middle" class="box-detail">:3001</text>
  
  <rect x="200" y="460" width="100" height="45" rx="5" fill="#16213e"/>
  <text x="250" y="480" text-anchor="middle" class="box-label">Watchtower</text>
  <text x="250" y="495" text-anchor="middle" class="box-detail">Monitor Only</text>
  
  <rect x="330" y="460" width="100" height="45" rx="5" fill="#16213e"/>
  <text x="380" y="480" text-anchor="middle" class="box-label">Graylog</text>
  <text x="380" y="495" text-anchor="middle" class="box-detail">:9001</text>
  
  <rect x="460" y="460" width="80" height="45" rx="5" fill="#9b59b6"/>
  <text x="500" y="480" text-anchor="middle" class="box-label">MongoDB</text>
  <text x="500" y="495" text-anchor="middle" class="box-detail">172.20.0.30</text>
  
  <rect x="560" y="460" width="90" height="45" rx="5" fill="#9b59b6"/>
  <text x="605" y="480" text-anchor="middle" class="box-label">OpenSearch</text>
  <text x="605" y="495" text-anchor="middle" class="box-detail">172.20.0.31</text>
  
  <rect x="680" y="460" width="80" height="45" rx="5" fill="#16213e"/>
  <text x="720" y="480" text-anchor="middle" class="box-label">n8n</text>
  <text x="720" y="495" text-anchor="middle" class="box-detail">:5678</text>
  
  <!-- Graylog dependencies -->
  <line x1="430" y1="482" x2="455" y2="482" class="arrow-depends"/>
  <line x1="430" y1="482" x2="555" y2="482" class="arrow-depends"/>
  
  <!-- All services send logs to Graylog -->
  <text x="380" y="530" text-anchor="middle" font-size="10" fill="#666">← All containers send logs via GELF UDP :12201 →</text>
  
  <!-- Infrastructure Layer -->
  <rect x="50" y="570" width="900" height="110" rx="5" fill="#16213e" opacity="0.1" stroke="#16213e" stroke-width="1"/>
  <text x="70" y="595" class="section-label">Core Infrastructure (Start First)</text>
  
  <rect x="70" y="610" width="100" height="45" rx="5" fill="#16213e"/>
  <text x="120" y="630" text-anchor="middle" class="box-label">Portainer</text>
  <text x="120" y="645" text-anchor="middle" class="box-detail">:9000</text>
  
  <rect x="200" y="610" width="100" height="45" rx="5" fill="#16213e"/>
  <text x="250" y="630" text-anchor="middle" class="box-label">Tailscale</text>
  <text x="250" y="645" text-anchor="middle" class="box-detail">VPN Mesh</text>
  
  <rect x="330" y="610" width="100" height="45" rx="5" fill="#16213e"/>
  <text x="380" y="630" text-anchor="middle" class="box-label">Pi-hole</text>
  <text x="380" y="645" text-anchor="middle" class="box-detail">DNS :53</text>
  
  <rect x="460" y="610" width="120" height="45" rx="5" fill="#16213e"/>
  <text x="520" y="630" text-anchor="middle" class="box-label">NGINX PM</text>
  <text x="520" y="645" text-anchor="middle" class="box-detail">:80/:443</text>
  
  <!-- Startup order arrows -->
  <line x1="170" y1="632" x2="195" y2="632" class="arrow"/>
  <line x1="300" y1="632" x2="325" y2="632" class="arrow"/>
  <line x1="430" y1="632" x2="455" y2="632" class="arrow"/>
  
  <text x="350" y="672" text-anchor="middle" font-size="10" fill="#666">Startup Order: Portainer → Tailscale → Pi-hole → NGINX → All Other Services</text>
</svg>
